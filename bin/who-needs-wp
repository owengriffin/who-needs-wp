#!/bin/ruby
$: << File.expand_path(File.dirname(__FILE__) + "/../lib")

require 'rubygems'
require 'choice'
require 'who-needs-wp.rb'

PROGRAM_VERSION = "0.5.0"

if File.exists? ".who-needs-wp.yaml"
  options = YAML.load_file('.who-needs-wp.yaml') 
else
  options = {}
end

Choice.options do
  header 'A static web site generator. Generates a blog based on Markdown-formatted documents.'
  header ''
  header 'Options are initially read from .who-needs-wp.yaml and over-written by any of the following.'
  header ''

  option :stylesheet do
    short '-s'
    long '--stylesheet=STYLESHEET'
    desc "A CSS file which will be included in every page generated. (Default: \"#{options[:stylesheet]}\")"
    default options[:stylesheet]
  end

  option :url do
    short '-u'
    long '--url-prefix=URL'
    desc "Prefix any generated link with the specified URL. (Default: \"#{options[:url]}\")"
    default options[:url]
  end

  option :title do
    short '-t'
    long '--title=TITLE'
    desc "Title of the blog (Default: \"#{options[:title]}\")"
    default options[:title]
  end

  option :author do
    short '-a'
    long '--author=AUTHOR'
    desc "Author of the blog (Default: \"#{options[:author]}\")"
    default options[:author]
  end

  option :upload do
    short '-p'
    long '--upload'
    desc 'Upload the output to an FTP address.'
  end

  option :remote_addr do
    long '--remote-addr=username'
    desc "Location to upload the output. To enable specify the --upload option. (Default: \"#{options[:ftp]}\")"
  end

  option :help do
    long '--help'
    desc 'Show this message'
  end

  option :version do
    short '-v'
    long '--version'
    desc 'Show version'
    action do
      puts "v#{PROGRAM_VERSION}"
      exit
    end
  end

end

Choice.choices.each do |key, value|
  options[key.to_sym] = value
end
WhoNeedsWP::generate(options)
